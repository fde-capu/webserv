# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    42_tester.conf                                     :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: fde-capu <fde-capu@student.42sp.org.br>    +#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2022/02/09 20:09:45 by fde-capu          #+#    #+#              #
#    Updated: 2022/02/12 21:33:40 by fde-capu         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

# (*) optional = at least one must be done.

events {} # Needed by nginx, not implemented and ignored by webserv.

http {

#	Disables default persistent connection of nginx to behave like webserv.
	keepalive_timeout 0;
#	Accepted thus ignored by webserv, since not implemented.

#	Able to limit client max_body_size:
	client_max_body_size 200;
#   From: https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size
#	Syntax:		client_max_body_size size;
#	Default:	client_max_body_size 1m;
#	Context:	http, server, location
#	Sets the maximum allowed size of the client request body. If the size in a
#	request exceeds the configured value, the 413 (Request Entity Too Large)
#	error is returned to the client. Please be aware that browsers cannot
#	correctly display this error. Setting size to 0 disables checking of
#	client request body size.

#	Since mime.types is not in use, tell nginx to serve .html
#	-- as well as .htm (not default behavior) -- files as text/html.
	types
	{
		text/html	html htm;
	}

#################################################################

	server
	{
		listen		3490;
		server_name	localhost;

#!		nginx accepts subdirectories. Optional (*)
		location /
		{
			root   html;

#!			default file to serve if none given, optional. (*)
#			this 'root html' has only the '.htm' file, works!
			index  index.html index.htm;

#			client_max_body_size works nested.
			client_max_body_size 50;

#			Optional on/off (*).
			autoindex on;

##			list of accepted methods, optional (*).
#			if ( $request_method !~ ^(GET|POST|DELETE)$ ) { return 405; }

##			nginx accepts upload files? test. mandatory.
##			Directive to setup upload location: Optional (*).
		}

#		client_max_body_size works nested.
		client_max_body_size	100;

##		error pages (must have defaults if ommited).
#		error_page   500 502 503 504  /50x.html;
##		setup is optional (*)
#		location = /50x.html {
#			root   html;
#		}

##		Optional 1 CGI, (bonus > 1, mandatory must be perfect). (*)
#		location ~ \.php$ {
#			root           html;
#			include        conf/fastcgi_params;
#			fastcgi_pass   127.0.0.1:9000;
#			fastcgi_index  index.php;
#			fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
#		}
	}

#################################################################

#	First server of localhost:3490 is above, so this is ignored.
#	Conflicting name:port generates ignore warning on nginx startup.

	server
	{
		listen		3490;
		location /
		{
			root	bad_folder;
		}
	}

#################################################################

#	Identify the server block trough server_name.
#	Client must decipt Host header.
#	This also demonstrates that the absence of index defaults to html/htm.

	server
	{
		listen		3490;
		server_name	krazything;
		location /
		{
			root	html-custom-server-name;
		}
	}

#################################################################

	server
	{
		listen		3491;

#		set server_names (or not);
		server_name	localhostB3491;

		location /
		{
			root   htmlB3491;
			index  index.html index.htm;

##			list of accepted methods. Optional (*)
#			if ( $request_method !~ ^(GET)$ ) { return 405; }
		}
	}

#################################################################

	server
	{
		listen		3492;

##		No "location" nor "redirect", so it is forbidden 403.
##		(set server_names) or not, default = "";
##		server_name localhost-blabla; (commented on purpose)
	}

#################################################################

	server
	{
		listen		3493;

#		multiple server_name; free-bonus.
		server_name	local-redirect localhost;

#		optional redirect (*)
		return 301 http://localhost:3490/;
	}

#################################################################

	server
	{
		listen		4242;

		location /
		{
			root html4242;
			index index.html index.html;
			if ( $request_method !~ ^(GET)$ ) { return 405; }

#			Optional on/off (*).
			autoindex on;
		}

		location /put_test/
		{
			if ( $request_method !~ ^(PUT)$ ) { return 405; }
			root html4242/uploads;
		}

#		Optional 1 CGI, (bonus > 1, mandatory must be perfect). (*)
		location ~ \.bla$ {
			root           html4242;
			include        conf/fastcgi_params;
#			fastcgi_pass   127.0.0.1:9000;
#			fastcgi_index  index.php;
			fastcgi_param  SCRIPT_FILENAME  /cgi_tester;
		}

		location /post_body
		{
			if ( $request_method !~ ^(POST)$ ) { return 405; }
#			client_max_body_size works nested.
			client_max_body_size	100;
		}

		location /directory/
		{
			if ( $request_method !~ ^(GET)$ ) { return 405; }
			root	html4242/YoupiBanane;
			index	youpi.bad_extension; 
		}
	}

}
